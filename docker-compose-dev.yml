version: "2"

services:
  guacamole-client:
    extends:
      file: ./docker-compose.yml
      service: guacamole-client
    container_name: guacamole-client

  guacd:
    extends:
      file: ./docker-compose.yml
      service: guacd
    container_name: guacd

  ubuntu-qemu:
    extends:
      file: ./docker-compose.yml
      service: ubuntu-qemu
    container_name: ubuntu-qemu

  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile-dev
    image: human-apps/backend:dev
    volumes_from:
      - frontend
    volumes:
      - ./backend:/opt
    networks:
      - human-apps
    ports:
      - 3000:3000
      - 5858:5858
      - 8081:8081
    container_name: backend
    restart: always

  frontend:
    extends:
      file: ./docker-compose.yml
      service: frontend
    build:
      context: ./frontend
      dockerfile: Dockerfile-dev
    image: human-apps/frontend:dev
    volumes:
      - ./frontend:/opt
    ports:
      - 49152:49152
      - 4200:4200
    container_name: frontend
    restart: always

  proxy:
    build: ./nginx
    ports:
      - 80:80
    image: human-apps/proxy
    depends_on:
      - backend
    restart: always
    container_name: "proxy"
    networks:
      - human-apps

networks:
  human-apps:
    driver: bridge
